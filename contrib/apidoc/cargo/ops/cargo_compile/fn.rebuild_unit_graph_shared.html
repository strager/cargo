<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="This is used to rebuild the unit graph, sharing host dependencies if possible."><meta name="keywords" content="rust, rustlang, rust-lang, rebuild_unit_graph_shared"><title>rebuild_unit_graph_shared in cargo::ops::cargo_compile - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" href="../../../normalize.css"><link rel="stylesheet" href="../../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" href="../../../ayu.css" disabled><link rel="stylesheet" href="../../../dark.css" disabled><link rel="stylesheet" href="../../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../../storage.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../../main.js"></script><noscript><link rel="stylesheet" href="../../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../../favicon.svg"></head><body class="rustdoc fn"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../../cargo/index.html"><div class="logo-container"><img class="rust-logo" src="../../../rust-logo.svg" alt="logo"></div></a><h2></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../../../cargo/index.html"><div class="logo-container"><img class="rust-logo" src="../../../rust-logo.svg" alt="logo"></div></a><div class="sidebar-elems"><h2><a href="index.html">In cargo::ops::cargo_compile</a></h2></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../wheel.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1 class="fqn">Function <a href="../../index.html">cargo</a>::<wbr><a href="../index.html">ops</a>::<wbr><a href="index.html">cargo_compile</a>::<wbr><a class="fn" href="#">rebuild_unit_graph_shared</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../../../src/cargo/ops/cargo_compile/mod.rs.html#560-585">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><div class="item-decl"><pre class="rust fn"><code>fn rebuild_unit_graph_shared(<br>&nbsp;&nbsp;&nbsp;&nbsp;interner: &amp;<a class="struct" href="../../core/compiler/unit/struct.UnitInterner.html" title="struct cargo::core::compiler::unit::UnitInterner">UnitInterner</a>,<br>&nbsp;&nbsp;&nbsp;&nbsp;unit_graph: <a class="type" href="../../core/compiler/unit_graph/type.UnitGraph.html" title="type cargo::core::compiler::unit_graph::UnitGraph">UnitGraph</a>,<br>&nbsp;&nbsp;&nbsp;&nbsp;roots: &amp;[<a class="struct" href="../../core/compiler/unit/struct.Unit.html" title="struct cargo::core::compiler::unit::Unit">Unit</a>],<br>&nbsp;&nbsp;&nbsp;&nbsp;scrape_units: &amp;[<a class="struct" href="../../core/compiler/unit/struct.Unit.html" title="struct cargo::core::compiler::unit::Unit">Unit</a>],<br>&nbsp;&nbsp;&nbsp;&nbsp;to_host: <a class="enum" href="../../core/compiler/compile_kind/enum.CompileKind.html" title="enum cargo::core::compiler::compile_kind::CompileKind">CompileKind</a><br>) -&gt; (<a class="struct" href="https://doc.rust-lang.org/1.66.0/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="struct" href="../../core/compiler/unit/struct.Unit.html" title="struct cargo::core::compiler::unit::Unit">Unit</a>&gt;, <a class="struct" href="https://doc.rust-lang.org/1.66.0/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="struct" href="../../core/compiler/unit/struct.Unit.html" title="struct cargo::core::compiler::unit::Unit">Unit</a>&gt;, <a class="type" href="../../core/compiler/unit_graph/type.UnitGraph.html" title="type cargo::core::compiler::unit_graph::UnitGraph">UnitGraph</a>)</code></pre></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>This is used to rebuild the unit graph, sharing host dependencies if possible.</p>
<p>This will translate any unit’s <code>CompileKind::Target(host)</code> to
<code>CompileKind::Host</code> if the kind is equal to <code>to_host</code>. This also handles
generating the unit <code>dep_hash</code>, and merging shared units if possible.</p>
<p>This is necessary because if normal dependencies used <code>CompileKind::Host</code>,
there would be no way to distinguish those units from build-dependency
units. This can cause a problem if a shared normal/build dependency needs
to link to another dependency whose features differ based on whether or
not it is a normal or build dependency. If both units used
<code>CompileKind::Host</code>, then they would end up being identical, causing a
collision in the <code>UnitGraph</code>, and Cargo would end up randomly choosing one
value or the other.</p>
<p>The solution is to keep normal and build dependencies separate when
building the unit graph, and then run this second pass which will try to
combine shared dependencies safely. By adding a hash of the dependencies
to the <code>Unit</code>, this allows the <code>CompileKind</code> to be changed back to <code>Host</code>
without fear of an unwanted collision.</p>
</div></details></section></div></main><div id="rustdoc-vars" data-root-path="../../../" data-current-crate="cargo" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.66.0 (69f9c33d7 2022-12-12)" ></div></body></html>